<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta th:insert="prerequis">
	<meta th:fragment="prerequis">
	<meta charset="UTF-8">
	<title> Orange Madagascar </title>
</head>
<body>
	<!-- body-->
    <section id="container" class="sidebar-close">
    
    <div th:insert="entete"></div>
	<div th:fragment="entete"></div>
	
	<div th:insert="sidemenu"></div>
	<div th:fragment="sidemenu"></div>
	
	
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content" style="margin-left: 210px;">
      <section class="wrapper site-min-height">
        <h3><i class="fa fa-angle-right"></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Principale </font></font></h3>
        <div class="row mt">
          <div class="col-lg-12">
          <!-- **********************************************************************************************************************************************************
                *********************************************************************************************************************************************************** -->
          
            <section id="">
		      <section class="wrapper">
		        <h3><i class="fa fa-angle-right"></i>List des machines </h3>
		        <div class="row mb">
		          <!-- page start-->
		          <div class="content-panel">
		            <div class="adv-table">
		              <table cellpadding="0" cellspacing="0" border="0" class="display table table-bordered" id="hidden-table-info">
		                <thead>
		                  <tr>
		                  <th class="hidden"> id </th>
		                    <th> Nom </th>
		                    <th> Adresse IP </th>
		                    <th class="hidden-phone"> serveur Physique </th>
		                    <th class="hidden-phone"> Mysql </th>
		                    <th class="hidden-phone"> RAM </th>
		                    <th class="hidden-phone"> CPU </th>
		                    <th class="hidden-phone"> DISQUE </th>
		                  </tr>
		                </thead>
		                <tbody>
		                
		                <div th:each="serv:${bdserv}">
		                
		                  <tr th:if="${serv.stat.Mysql == true}" class="gradeA">
		                  	<td class="hidden" th:text="${serv.id_appareil}"></td>
		                    <td th:text="${serv.nom}"></td>
							<td th:text="${serv.ip.part1 + '.' + serv.ip.part2 + '.' + serv.ip.part3 + '.' + serv.ip.part4}"></td>
							<td th:text="${serv.serveur.nom + '(' + serv.serveur.ip.part1 + '.' + serv.serveur.ip.part2 + '.' + serv.serveur.ip.part3 + '.' + serv.serveur.ip.part4 + ')'}"></td>
							<td th:if="${serv.stat.Mysql == true}" th:text="${'UP'}"></td>							
							<td th:text="${serv.stat.RAM}"></td>
							<td th:text="${serv.stat.CPU}"></td>
							<td th:text="${serv.stat.Disque}"></td>		                    
		                  </tr>	
		                  
		                  <tr th:if="${serv.stat.Mysql == false}" class="gradeX">
		                  <td class="hidden" th:text="${serv.id_appareil}"></td>
		                    <td th:text="${serv.nom}"></td>
							<td th:text="${serv.ip.part1 + '.' + serv.ip.part2 + '.' + serv.ip.part3 + '.' + serv.ip.part4}"></td>
							<td th:text="${serv.serveur.nom + '(' + serv.serveur.ip.part1 + '.' + serv.serveur.ip.part2 + '.' + serv.serveur.ip.part3 + '.' + serv.serveur.ip.part4 + ')'}"></td>
							<td th:if="${serv.stat.Mysql == false}" th:text="${'DOWN'}"></td>							
							<td th:text="${serv.stat.RAM}"></td>
							<td th:text="${serv.stat.CPU}"></td>
							<td th:text="${serv.stat.Disque}"></td>		                    
		                  </tr>	
		                  	                  
		                  <div th:each="dserv:${serv.dserveur}">
		                  
		                  <tr th:if="${dserv.stat.Mysql == true}" class="gradeC">
		                  <td class="hidden" th:text="${dserv.id_appareil}"></td>
		                    <td th:text="${dserv.nom}"></td>
		                    <td th:text="${dserv.ip}"></td>
		                    <td th:text="${serv.serveur.nom + '(' + serv.serveur.ip.part1 + '.' + serv.serveur.ip.part2 + '.' + serv.serveur.ip.part3 + '.' + serv.serveur.ip.part4 + ')'}"></td>
							<td th:if="${dserv.stat.Mysql == true}" th:text="${'UP'}"></td>
		                    <td th:text="${dserv.stat.RAM}"></td>
		                    <td th:text="${dserv.stat.CPU}"></td>
		                    <td th:text="${dserv.stat.Disque}"></td>
		                  </tr>
		                  
		                  <tr th:if="${dserv.stat.Mysql == false}" class="gradeX">
		                  <td class="hidden" th:text="${dserv.id_appareil}"></td>
		                    <td th:text="${dserv.nom}"></td>
		                    <td th:text="${dserv.ip}"></td>
		                    <td th:text="${serv.serveur.nom + '(' + serv.serveur.ip.part1 + '.' + serv.serveur.ip.part2 + '.' + serv.serveur.ip.part3 + '.' + serv.serveur.ip.part4 + ')'}"></td>
							<td th:if="${dserv.stat.Mysql == false}" th:text="${'DOWN'}"></td>
		                    <td th:text="${dserv.stat.RAM}"></td>
		                    <td th:text="${dserv.stat.CPU}"></td>
		                    <td th:text="${dserv.stat.Disque}"></td>
		                  </tr>	                  
		                  </div>
		                  </div>
		                  
		                </tbody>
		              </table>
		            </div>
		          </div>
		          <!-- page end-->
		        </div>
		        <!-- /row -->
		      </section>
		      <!-- /wrapper -->
		    </section>
		            
            
            
           <!-- **********************************************************************************************************************************************************
           *********************************************************************************************************************************************************** -->
          </div>
        </div>
      </section>
      <!-- /wrapper -->
    </section>
    <!-- /MAIN CONTENT -->
    <!--main content end-->
  	
  	<div th:insert="pied"></div>
	<div th:fragment="pied"></div>  
  </section>

		<script type="text/javascript" language="javascript" src="script/advanced-datatable/js/jquery.js"></script>
        <script src="script/bootstrap.js"></script>
        <script src="script/respond.js"></script>
        
	  <script src="script/jquery-ui-1.9.2.custom.min.js"></script>
	  <script src="script/jquery.ui.touch-punch.min.js"></script>
	  <script src="script/jquery.dcjqaccordion.2.7.js"></script>
	  <script src="script/jquery.scrollTo.min.js"></script>
	  <script src="script/jquery.nicescroll.js" type="text/javascript"></script>
	  <script src="script/common-scripts.js"></script>
	  

	<script type="text/javascript" language="javascript" src="script/advanced-datatable/js/jquery.dataTables.js"></script>
	<script type="text/javascript" src="script/advanced-datatable/js/DT_bootstrap.js"></script>
		
	<script type="text/javascript">
    /* Formating function for row details */
    function fnFormatDetails(oTable, nTr) {
      var aData = oTable.fnGetData(nTr);
      var sOut = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';
      sOut += '<tr><td> Detail: </td><td>' + aData[2] + ' ( ' + aData[3] + ') </td></tr>';
      sOut += '<tr><td> Lien:</td><td><a href="/detail?serv='+ aData[1] + '">Voir detail</a></td></tr>';
      sOut += '</table>';

      return sOut;
    }

    $(document).ready(function() {
      /*
       * Insert a 'details' column to the table
       */
      var nCloneTh = document.createElement('th');
      var nCloneTd = document.createElement('td');
      nCloneTd.innerHTML = '<img src="script/advanced-datatable/images/details_open.png">';
      nCloneTd.className = "center";

      $('#hidden-table-info thead tr').each(function() {
        this.insertBefore(nCloneTh, this.childNodes[0]);
      });

      $('#hidden-table-info tbody tr').each(function() {
        this.insertBefore(nCloneTd.cloneNode(true), this.childNodes[0]);
      });

      /*
       * Initialse DataTables, with no sorting on the 'details' column
       */
      var oTable = $('#hidden-table-info').dataTable({
        "aoColumnDefs": [{
          "bSortable": false,
          "aTargets": [0]
        }],
        "aaSorting": [
          [1, 'asc']
        ]
      });

      /* Add event listener for opening and closing details
       * Note that the indicator for showing which row is open is not controlled by DataTables,
       * rather it is done here
       */
      $('#hidden-table-info tbody td img').live('click', function() {
        var nTr = $(this).parents('tr')[0];
        if (oTable.fnIsOpen(nTr)) {
          /* This row is already open - close it */
          this.src = "script/advanced-datatable/images/details_open.png";
          oTable.fnClose(nTr);
        } else {
          /* Open this row */
          this.src = "script/advanced-datatable/images/details_close.png";
          oTable.fnOpen(nTr, fnFormatDetails(oTable, nTr), 'details');
          $(this).load("/serveurList");  
        }
      });
    });
  </script>
	
</body>
</html>